(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[442],{5341:(e,n,t)=>{"use strict";t.d(n,{default:()=>l});var r=t(5155),i=t(2115);function s(e){let{onRecognizeKanji:n,isLoading:t,setIsLoading:s}=e,a=(0,i.useRef)(null),[l,c]=(0,i.useState)(!1),[o,d]=(0,i.useState)(null),[h,u]=(0,i.useState)(null),[x,g]=(0,i.useState)(null),[m,j]=(0,i.useState)([]),[p,f]=(0,i.useState)([]),[y,v]=(0,i.useState)(!1),N=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(!a.current)return;let e=()=>{let e=a.current;if(!e)return;let n=e.getBoundingClientRect();e.width=n.width,e.height=n.height;let t=e.getContext("2d",{willReadFrequently:!0});t&&(t.lineWidth=8,t.lineCap="round",t.lineJoin="round",t.strokeStyle="black",d(t),b(t))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[m]);let b=(0,i.useCallback)(e=>{e.clearRect(0,0,e.canvas.width,e.canvas.height),m.forEach(n=>{if(!(n.points.length<2)){e.beginPath(),e.moveTo(n.points[0].x,n.points[0].y);for(let t=1;t<n.points.length;t++){let r=n.points[t-1],i=n.points[t],s={x:(r.x+i.x)/2,y:(r.y+i.y)/2};e.quadraticCurveTo(r.x,r.y,s.x,s.y)}e.stroke()}})},[m]),w=e=>{if(!a.current)return{x:0,y:0};let n=a.current.getBoundingClientRect(),t=a.current.width/n.width,r=a.current.height/n.height;return{x:(e.clientX-n.left)*t,y:(e.clientY-n.top)*r}},k=e=>{if(!l||!o||!x)return;e.preventDefault();let n=w(e);o.beginPath(),o.moveTo(x.x,x.y),o.lineTo(n.x,n.y),o.stroke(),j(e=>[...e,{points:[...p,n]}]),f([]),c(!1),g(null),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{y&&C()},800)},C=async()=>{if(a.current&&!t&&y){s(!0),u(null);try{let e=a.current.toDataURL("image/png",1),t=await fetch("/api/ai/recognize-kanji",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e})}),r=await t.json();if(!t.ok)throw Error(r.error||"Failed to recognize kanji");if(!r.success)throw Error(r.error||"Recognition failed");n(r.kanji)}catch(e){console.error("Error in real-time kanji recognition:",e),e instanceof Error&&u("Kh\xf4ng thể nhận dạng tự động: ".concat(e.message))}finally{s(!1)}}},E=async()=>{var e,t;if(!a.current||!y){u("Vui l\xf2ng vẽ một chữ Kanji trước khi nhận dạng");return}s(!0),u(null);try{let t=a.current.toDataURL("image/png",1);console.log("Image data length:",t.length);let r=await fetch("/api/ai/recognize-kanji",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:t})}),i=await r.json();if(!r.ok){if(500===r.status&&(null===(e=i.error)||void 0===e?void 0:e.includes("deprecated")))throw Error("AI model has been deprecated. Please contact admin for an update.");throw Error(i.error||"Failed to recognize kanji")}if(!i.success)throw Error(i.error||"Recognition failed");n(i.kanji)}catch(e){console.error("Error recognizing kanji:",e),e instanceof Error?(null===(t=e.message)||void 0===t?void 0:t.includes("deprecated"))?u("Hệ thống AI đ\xe3 lỗi thời. Vui l\xf2ng li\xean hệ quản trị vi\xean để cập nhật."):u("Kh\xf4ng thể nhận dạng Kanji: ".concat(e.message||"Đ\xe3 xảy ra lỗi",". Vui l\xf2ng thử lại.")):u("Kh\xf4ng thể nhận dạng Kanji: Đ\xe3 xảy ra lỗi. Vui l\xf2ng thử lại."),n(null)}finally{s(!1)}};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden",children:(0,r.jsx)("canvas",{ref:a,className:"bg-white w-full h-[400px] touch-none",onPointerDown:e=>{if(!o)return;e.preventDefault(),c(!0);let n=w(e);g(n),f([n]),o.beginPath(),o.moveTo(n.x,n.y),N.current&&clearTimeout(N.current)},onPointerMove:e=>{if(!l||!o||!x)return;e.preventDefault();let n=w(e);f(e=>[...e,n]),v(!0),o.beginPath(),o.moveTo(x.x,x.y);let t={x:(x.x+n.x)/2,y:(x.y+n.y)/2};o.quadraticCurveTo(x.x,x.y,t.x,t.y),o.stroke(),g(n)},onPointerUp:k,onPointerOut:k,style:{touchAction:"none"}})}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{onClick:()=>{o&&a.current&&(o.clearRect(0,0,a.current.width,a.current.height),j([]),f([]),v(!1),n(null),u(null),N.current&&clearTimeout(N.current))},className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:t,children:"X\xf3a"}),(0,r.jsx)("button",{onClick:E,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-300",disabled:t,children:t?"Đang nhận dạng...":"Nhận dạng Kanji"})]}),h&&(0,r.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 text-red-600 rounded-lg text-sm",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Lỗi:"}),(0,r.jsx)("p",{children:h}),"string"==typeof h&&h.includes("AI đ\xe3 lỗi thời")&&(0,r.jsx)("p",{className:"mt-1 text-xs",children:"Chi tiết kỹ thuật: Gemini 1.0 Pro Vision đ\xe3 ngừng hoạt động từ 12/7/2024. Cần cập nhật l\xean gemini-1.5-flash."})]}),t&&(0,r.jsxs)("div",{className:"flex items-center justify-center py-2 text-sm text-blue-600",children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang ph\xe2n t\xedch n\xe9t vẽ..."]})]})}function a(e){let{kanji:n,isLoading:t=!1}=e;return t?(0,r.jsx)("div",{className:"h-full flex items-center justify-center border rounded-lg p-12",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-block animate-pulse",children:(0,r.jsx)("span",{className:"text-7xl font-japanese text-gray-300",children:"字"})}),(0,r.jsx)("p",{className:"mt-4 text-gray-500",children:"Đang nhận dạng chữ Kanji..."})]})}):n?(0,r.jsxs)("div",{className:"border rounded-lg p-6 space-y-4",children:[(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("span",{className:"text-7xl font-japanese",children:n.character})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-500",children:"\xc2m On:"}),(0,r.jsx)("p",{children:n.onReading.join(", ")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-500",children:"\xc2m Kun:"}),(0,r.jsx)("p",{children:n.kunReading.join(", ")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-500",children:"Số n\xe9t:"}),(0,r.jsx)("p",{children:n.strokeCount})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-500",children:"JLPT:"}),(0,r.jsx)("p",{children:n.jlptLevel})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-500",children:"Nghĩa:"}),(0,r.jsx)("p",{children:n.meaning.join(", ")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-500",children:"V\xed dụ:"}),(0,r.jsx)("ul",{className:"space-y-2 mt-2",children:n.examples.map((e,n)=>(0,r.jsxs)("li",{className:"border-b pb-2",children:[(0,r.jsx)("p",{className:"font-medium",children:e.word}),(0,r.jsx)("p",{className:"text-sm",children:e.reading}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.meaning})]},n))})]})]}):(0,r.jsx)("div",{className:"h-full flex items-center justify-center border rounded-lg p-12",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[(0,r.jsx)("p",{className:"text-lg mb-2",children:"Vẽ một chữ Kanji để nhận dạng"}),(0,r.jsx)("p",{className:"text-sm",children:"Hệ thống AI sẽ ph\xe2n t\xedch v\xe0 cung cấp th\xf4ng tin chi tiết về chữ Kanji của bạn"}),(0,r.jsx)("p",{className:"text-xs mt-4 text-gray-400",children:"Hệ thống sẽ tự động nhận dạng sau khi bạn ho\xe0n th\xe0nh n\xe9t vẽ"})]})})}function l(){let[e,n]=(0,i.useState)(null),[t,l]=(0,i.useState)(!1);return(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-8",children:[(0,r.jsx)("div",{className:"md:w-1/2",children:(0,r.jsx)(s,{onRecognizeKanji:n,isLoading:t,setIsLoading:l})}),(0,r.jsx)("div",{className:"md:w-1/2",children:(0,r.jsx)(a,{kanji:e,isLoading:t})})]})}},9650:(e,n,t)=>{Promise.resolve().then(t.bind(t,5341))}},e=>{var n=n=>e(e.s=n);e.O(0,[441,684,358],()=>n(9650)),_N_E=e.O()}]);